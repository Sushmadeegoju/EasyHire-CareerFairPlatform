import t,{createContext as e,useRef as r,useState as n,useLayoutEffect as o,useContext as a}from"react";import*as i from"react-router-dom";import{Router as c}from"react-router-dom";import{useSyncExternalStore as l}from"use-sync-external-store/shim";function s(){return s=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},s.apply(this,arguments)}var u,h;function f(t,e){return{usr:t.state,key:t.key,idx:e}}function p(t,e,r,n){return void 0===r&&(r=null),s({pathname:"string"==typeof t?t:t.pathname,search:"",hash:""},"string"==typeof e?function(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}(e):e,{state:r,key:e&&e.key||n||Math.random().toString(36).substr(2,8)})}function d(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&"?"!==r&&(e+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(u||(u={})),function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(h||(h={}));const v=e(null);function m({basename:e,children:a,window:i,history:l}){const h=r(new Set);let m=r(null);var y;null==m.current&&(m.current=l||(void 0===(y={window:i,v5Compat:!0})&&(y={}),function(t,e,r,n){void 0===n&&(n={});let{window:o=document.defaultView,v5Compat:a=!1}=n,i=o.history,c=u.Pop,l=null,h=v();function v(){return(i.state||{idx:null}).idx}function m(){c=u.Pop;let t=v(),e=null==t?null:t-h;h=t,l&&l({action:c,location:g.location,delta:e})}function y(t){let e="null"!==o.location.origin?o.location.origin:o.location.href,r="string"==typeof t?t:d(t);return function(t,e){if(!1===t||null==t)throw new Error(e)}(e,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,e)}null==h&&(h=0,i.replaceState(s({},i.state,{idx:h}),""));let g={get action(){return c},get location(){return function(t,e){let{pathname:r,search:n,hash:o}=t.location;return p("",{pathname:r,search:n,hash:o},e.state&&e.state.usr||null,e.state&&e.state.key||"default")}(o,i)},listen(t){if(l)throw new Error("A history only accepts one active listener");return o.addEventListener("popstate",m),l=t,()=>{o.removeEventListener("popstate",m),l=null}},createHref:t=>function(t,e){return"string"==typeof e?e:d(e)}(0,t),createURL:y,encodeLocation(t){let e=y(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,e){c=u.Push;let r=p(g.location,t,e);h=v()+1;let n=f(r,h),s=g.createHref(r);try{i.pushState(n,"",s)}catch(t){if(t instanceof DOMException&&"DataCloneError"===t.name)throw t;o.location.assign(s)}a&&l&&l({action:c,location:g.location,delta:1})},replace:function(t,e){c=u.Replace;let r=p(g.location,t,e);h=v();let n=f(r,h),o=g.createHref(r);i.replaceState(n,"",o),a&&l&&l({action:c,location:g.location,delta:0})},go:t=>i.go(t)};return g}(0,0,0,y)));let g=m.current,[w,E]=n({action:g.action,location:g.location});return o(()=>g.listen(t=>{h.current.forEach(e=>e(t)),E(t)}),[g]),t.createElement(v.Provider,{value:{ref:h}},t.createElement(c,{basename:e,children:a,location:w.location,navigationType:w.action,navigator:g}))}function y(){return y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},y.apply(this,arguments)}const g="UNSAFE_".concat("DataRouterContext"),w="UNSAFE_".concat("NavigationContext"),E=()=>{if(!(w in i)&&"development"===process.env.NODE_ENV)throw new Error("[react-router-use-history]: only support react-router-dom >= 6");const t=a(i[w]).navigator,e=a(v);return y({},t,{listen:t=>{if(!e&&"development"===process.env.NODE_ENV)throw new Error("[react-router-use-history]: You should use import { BrowserRouter } from 'react-router-use-history', otherwise 'history.listen' will not working.");return null==e||e.ref.current.add(t),()=>{null==e||e.ref.current.delete(t)}}})},b=()=>{if(g in i){const r=a(i[g]);if(r){var t,e;const n=null==r||null==(t=r.router)?void 0:t.state;return y({get location(){return null==n?void 0:n.location},get action(){return null==n?void 0:n.historyAction},listen:null==r||null==(e=r.router)?void 0:e.subscribe},null==r?void 0:r.navigator)}}return E()},O=t=>{const e=b();return l(e.listen,()=>t(e))};export{m as BrowserRouter,v as UNSAFE_SubscriptionContext,E as useBrowserRouterHistory,b as useHistory,O as useHistorySelector};
//# sourceMappingURL=index.esm.mjs.map
