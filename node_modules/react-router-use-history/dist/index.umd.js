!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("react-router-dom"),require("use-sync-external-store/shim")):"function"==typeof define&&define.amd?define(["exports","react","react-router-dom","use-sync-external-store/shim"],e):e((t||self).reactRouterUseHistory={},t.React,t.reactRouterDom,t.shim)}(this,function(t,e,r,n){function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}),e.default=t,e}var i,u=/*#__PURE__*/o(e),c=/*#__PURE__*/a(r);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},l.apply(this,arguments)}!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(i||(i={}));const s="popstate";function f(t,e){return{usr:t.state,key:t.key,idx:e}}function h(t,e,r,n){return void 0===r&&(r=null),l({pathname:"string"==typeof t?t:t.pathname,search:"",hash:""},"string"==typeof e?function(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}(e):e,{state:r,key:e&&e.key||n||Math.random().toString(36).substr(2,8)})}function d(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&"?"!==r&&(e+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}var p;!function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(p||(p={}));var v=e.createContext(null);function y(){return y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},y.apply(this,arguments)}var g="UNSAFE_".concat("DataRouterContext"),m="UNSAFE_".concat("NavigationContext"),w=function(){if(!(m in c)&&"development"===process.env.NODE_ENV)throw new Error("[react-router-use-history]: only support react-router-dom >= 6");var t=e.useContext(c[m]).navigator,r=e.useContext(v);return y({},t,{listen:function(t){if(!r&&"development"===process.env.NODE_ENV)throw new Error("[react-router-use-history]: You should use import { BrowserRouter } from 'react-router-use-history', otherwise 'history.listen' will not working.");return null==r||r.ref.current.add(t),function(){null==r||r.ref.current.delete(t)}}})},b=function(){if(g in c){var t=e.useContext(c[g]);if(t){var r,n,o=null==t||null==(r=t.router)?void 0:r.state;return y({get location(){return null==o?void 0:o.location},get action(){return null==o?void 0:o.historyAction},listen:null==t||null==(n=t.router)?void 0:n.subscribe},null==t?void 0:t.navigator)}}return w()};t.BrowserRouter=function(t){var n,o=t.basename,a=t.children,c=t.window,p=t.history,y=e.useRef(new Set),g=e.useRef(null);null==g.current&&(g.current=p||(void 0===(n={window:c,v5Compat:!0})&&(n={}),function(t,e,r,n){void 0===n&&(n={});let{window:o=document.defaultView,v5Compat:a=!1}=n,u=o.history,c=i.Pop,p=null,v=y();function y(){return(u.state||{idx:null}).idx}function g(){c=i.Pop;let t=y(),e=null==t?null:t-v;v=t,p&&p({action:c,location:w.location,delta:e})}function m(t){let e="null"!==o.location.origin?o.location.origin:o.location.href,r="string"==typeof t?t:d(t);return function(t,e){if(!1===t||null==t)throw new Error(e)}(e,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,e)}null==v&&(v=0,u.replaceState(l({},u.state,{idx:v}),""));let w={get action(){return c},get location(){return function(t,e){let{pathname:r,search:n,hash:o}=t.location;return h("",{pathname:r,search:n,hash:o},e.state&&e.state.usr||null,e.state&&e.state.key||"default")}(o,u)},listen(t){if(p)throw new Error("A history only accepts one active listener");return o.addEventListener(s,g),p=t,()=>{o.removeEventListener(s,g),p=null}},createHref:t=>function(t,e){return"string"==typeof e?e:d(e)}(0,t),createURL:m,encodeLocation(t){let e=m(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,e){c=i.Push;let r=h(w.location,t,e);v=y()+1;let n=f(r,v),l=w.createHref(r);try{u.pushState(n,"",l)}catch(t){if(t instanceof DOMException&&"DataCloneError"===t.name)throw t;o.location.assign(l)}a&&p&&p({action:c,location:w.location,delta:1})},replace:function(t,e){c=i.Replace;let r=h(w.location,t,e);v=y();let n=f(r,v),o=w.createHref(r);u.replaceState(n,"",o),a&&p&&p({action:c,location:w.location,delta:0})},go:t=>u.go(t)};return w}(0,0,0,n)));var m=g.current,w=e.useState({action:m.action,location:m.location}),b=w[0],E=w[1];return e.useLayoutEffect(function(){return m.listen(function(t){y.current.forEach(function(e){return e(t)}),E(t)})},[m]),u.default.createElement(v.Provider,{value:{ref:y}},u.default.createElement(r.Router,{basename:o,children:a,location:b.location,navigationType:b.action,navigator:m}))},t.UNSAFE_SubscriptionContext=v,t.useBrowserRouterHistory=w,t.useHistory=b,t.useHistorySelector=function(t){var e=b();return n.useSyncExternalStore(e.listen,function(){return t(e)})}});
//# sourceMappingURL=index.umd.js.map
